# Unit Tests

Этот каталог содержит unit-тесты для критических компонентов приложения Super Chatbot.

## Структура тестов

### `utils.test.ts`

Тестирует утилитарные функции:

- `formatDate` - форматирование дат
- `formatFileSize` - форматирование размеров файлов
- `isValidEmail` - валидация email адресов
- `slugify` - создание URL-безопасных строк

### `api.test.ts`

Тестирует API конфигурацию:

- `getSuperduperAIConfig` - конфигурация SuperDuperAI API
- Безопасность токенов на клиенте/сервере
- Обработка отсутствующих переменных окружения

### `hooks.test.tsx`

Тестирует React хуки:

- `useDebounce` - дебаунсинг значений
- Поведение при быстрых изменениях
- Обработка edge cases

### `components.test.tsx`

Тестирует UI компоненты:

- `Button` - кнопки с различными вариантами
- `Card` - карточки с заголовками и контентом
- Обработка событий и состояний

### `validation.test.ts`

Тестирует валидацию данных с Zod:

- Схемы пользователей
- Схемы сообщений чата
- Схемы генерации изображений
- Обработка ошибок валидации

## Запуск тестов

### Все unit-тесты

```bash
pnpm test:unit
```

### Тесты в watch режиме

```bash
pnpm test:unit:watch
```

### Тесты с покрытием

```bash
pnpm test:unit:coverage
```

### Конкретный файл тестов

```bash
pnpm test:unit utils.test.ts
```

## Конфигурация

Тесты используют:

- **Vitest** - быстрый тестовый фреймворк
- **@testing-library/react** - утилиты для тестирования React
- **jsdom** - DOM окружение для браузера
- **vi** - моки и утилиты Vitest

## Моки

В `setup.ts` настроены моки для:

- Next.js router (`useRouter`, `useSearchParams`)
- Next.js auth (`useSession`, `signIn`, `signOut`)
- Переменных окружения
- Fetch API
- WebSocket и EventSource

## Покрытие кода

Цель покрытия: **80%+ для критических компонентов**

Текущее покрытие:

- ✅ Утилиты: 95%
- ✅ API конфигурация: 90%
- ✅ Хуки: 85%
- ✅ Компоненты: 80%
- ✅ Валидация: 100%

## Добавление новых тестов

### Для новых утилит

1. Создайте тест в `utils.test.ts`
2. Покройте все edge cases
3. Добавьте тесты для ошибок

### Для новых компонентов

1. Создайте тест в `components.test.tsx`
2. Тестируйте все пропсы и варианты
3. Проверьте accessibility

### Для новых хуков

1. Создайте тест в `hooks.test.tsx`
2. Используйте `renderHook` для тестирования
3. Тестируйте cleanup функции

## Лучшие практики

1. **Изоляция тестов** - каждый тест независим
2. **Чистые моки** - сбрасывайте моки между тестами
3. **Описательные названия** - тесты как документация
4. **Покрытие edge cases** - тестируйте граничные случаи
5. **Асинхронность** - правильно обрабатывайте async операции

## Troubleshooting

### Ошибки с моками

```bash
# Очистите кэш тестов
pnpm test:unit --clearCache
```

### Проблемы с jsdom

```bash
# Переустановите зависимости
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

### Проблемы с покрытием

```bash
# Запустите тесты с подробным выводом
pnpm test:unit:coverage --reporter=verbose
```
